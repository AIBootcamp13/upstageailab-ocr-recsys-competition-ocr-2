# October 2, 2025 â€” Backport progress

## Context
- Branch: `05_refactor/preprocessor`
- Reference fix branch: `05_refactor/preprocessor_d`
- Goal: Restore baseline recall by porting verified fixes while avoiding speculative rewrites.

## Actions completed
- Added DBNet postprocess thresholds (thresh=0.3, box_thresh=0.4, max_candidates=300, use_polygon=false) to `configs/model/architectures/dbnet.yaml`.
- Reinstated regression test to ensure architecture wiring forwards the postprocess block.
- Removed EXIF polygon rotation from the dataset pipeline and aligned WandB logging + tests with the new behaviour.
- Reverted validation metric aggregation to the sequential CLEval loop (no multiprocessing) for parity with the baseline implementation.
- Restored epoch-based validation cadence (`val_check_interval: null`, `check_val_every_n_epoch: 1`).
- Fixed Hydra callback struct wiring by declaring `callbacks: {}` in `train.yaml` and retagging the callback package.
- Verified recovery run: `uv run python runners/train.py exp_name=ocr_training-resnet18_preset wandb=true +preset.models.encoder.model_name=resnet18 +preset.models.optimizer.lr=0.00297 data.batch_size=12 trainer.max_epochs=2 seed=42` (Epoch 0 `val/recall=0.754`, `val/precision=0.937`, `val/hmean=0.828`).

## Next steps
- Run `pytest tests/test_architecture.py::TestOCRModel::test_dbnet_architecture_passes_postprocess_config` and related guardrails.
- Trigger a quick `trainer.max_epochs=0` predict run to confirm detections are emitted with the new postprocess thresholds.
- Update `docs/next_job/comments.md` with KEEP/REVERT notes after validating results.
