# @package _global_

# Global batch size setting for dataloaders
batch_size: 16

# Data configuration
data:
  # Dataset size limits for faster iterations
  train_num_samples: 500  # Process all training samples
  val_num_samples: 50    # Process all validation samples
  test_num_samples: 50      # Limit test to 50 samples

dataset_base_path: "${hydra:runtime.cwd}/data/datasets/"

datasets:
  train_dataset:
    _target_: ${dataset_path}.OCRDataset
    image_path: ${dataset_base_path}images/train
    annotation_path: ${dataset_base_path}jsons/train.json
    transform: ${transforms.train_transform}
    preload_maps: false  # Training dataset is large, don't preload
    preload_images: false  # Training dataset is large, don't preload
    image_loading_config: ${image_loading}
  val_dataset:
    _target_: ${dataset_path}.OCRDataset
    image_path: ${dataset_base_path}images_val_canonical # Using canonical (rotation-corrected) data
    annotation_path: ${dataset_base_path}jsons/val.json
    transform: ${transforms.val_transform}
    preload_maps: false  # Disabled as it doesn't provide performance benefit
    preload_images: false  # Enable for Phase 6B RAM caching benchmark
    prenormalize_images: false  # Enable to pre-normalize images in cache (87% of transform time)
    image_loading_config: ${image_loading}
  test_dataset:
    _target_: ${dataset_path}.OCRDataset
    image_path: ${dataset_base_path}images_val_canonical  # Using canonical (rotation-corrected) data
    annotation_path: ${dataset_base_path}jsons/val.json
    transform: ${transforms.test_transform}
    preload_images: false
    image_loading_config: ${image_loading}
  predict_dataset:
    _target_: ${dataset_path}.OCRDataset
    image_path: ${dataset_base_path}images/test
    annotation_path: null
    transform: ${transforms.test_transform}
    preload_images: false
    image_loading_config: ${image_loading}

collate_fn:
  _target_: ${dataset_path}.DBCollateFN
  shrink_ratio: 0.4
  thresh_min: 0.3
  thresh_max: 0.7

# Image loading optimization settings
image_loading:
  # TurboJPEG settings for faster JPEG decoding
  use_turbojpeg: true  # Enable TurboJPEG for JPEG files if available
  turbojpeg_fallback: true  # Fallback to PIL if TurboJPEG fails

  # Performance vs quality trade-offs
  interpolation_method: 1  # cv2.INTER_LINEAR (1) for speed, cv2.INTER_CUBIC (3) for quality
